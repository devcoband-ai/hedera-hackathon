<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1><%= @song.title %></h1>
    <span class="badge bg-secondary"><%= @song.status&.titleize %></span>
    <span class="text-muted ms-2"><%= @song.genre %></span>
    <% if @song.album.present? %>
      <span class="text-muted">Â· <%= @song.album %></span>
    <% end %>
  </div>
  <div class="d-flex gap-2">
    <%= link_to "Edit", edit_song_path(@song), class: "btn btn-outline-light btn-sm" %>
    <%= link_to "Provenance", song_provenance_path(@song), class: "btn btn-outline-info btn-sm" %>
    <%= link_to "ðŸ“¦ Export Package", song_provenance_package_path(@song, format: :json), class: "btn btn-outline-warning btn-sm" %>
    <%= link_to "ðŸ“œ Certificate", song_provenance_certificate_path(@song), class: "btn btn-outline-success btn-sm", target: "_blank" %>
    <%= button_to "Delete", song_path(@song), method: :delete, class: "btn btn-outline-danger btn-sm", data: { turbo_confirm: "Are you sure?" } %>
  </div>
</div>

<% if @song.description.present? %>
  <p class="text-muted"><%= @song.description %></p>
<% end %>

<% if @song.hedera_topic_id.present? %>
  <div class="alert alert-info">
    <strong>ðŸ”— Hedera Topic:</strong>
    <%= link_to @song.hedera_topic_id, "https://hashscan.io/testnet/topic/#{@song.hedera_topic_id}", target: "_blank", class: "alert-link" %>
    <small class="text-muted ms-2">(immutable provenance ledger)</small>
  </div>
<% end %>

<!-- Tracks -->
<div class="d-flex justify-content-between align-items-center mt-4 mb-3">
  <h3>ðŸŽµ Tracks</h3>
  <%= link_to "Add Track", new_song_track_path(@song), class: "btn btn-outline-primary btn-sm" %>
</div>

<% if @tracks.any? %>
  <table class="table table-dark table-striped">
    <thead>
      <tr><th>Title</th><th>Version</th><th>Notes</th><th></th></tr>
    </thead>
    <tbody>
      <% @tracks.each do |track| %>
        <tr>
          <td><%= track.title %></td>
          <td>v<%= track.version %></td>
          <td class="text-muted"><%= truncate(track.notes, length: 80) %></td>
          <td>
            <%= link_to "Edit", edit_song_track_path(@song, track), class: "btn btn-outline-light btn-sm" %>
            <%= button_to "Ã—", song_track_path(@song, track), method: :delete, class: "btn btn-outline-danger btn-sm" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-muted">No tracks yet.</p>
<% end %>

<!-- Contributions -->
<div class="d-flex justify-content-between align-items-center mt-4 mb-3">
  <h3>ðŸ‘¥ Contributions</h3>
  <%= link_to "Add Contribution", new_song_contribution_path(@song), class: "btn btn-outline-primary btn-sm" %>
</div>

<% if @contributions.any? %>
  <table class="table table-dark table-striped">
    <thead>
      <tr><th>#</th><th>Role</th><th>Actor</th><th>Type</th><th>Description</th><th>Hedera</th><th></th></tr>
    </thead>
    <tbody>
      <% @contributions.each do |c| %>
        <tr>
          <td><%= c.position %></td>
          <td><%= c.role.titleize %></td>
          <td><%= c.actor_name %></td>
          <td><span class="badge bg-<%= c.actor_type == 'human' ? 'success' : c.actor_type == 'ai' ? 'warning' : 'info' %>"><%= c.actor_type %></span></td>
          <td class="text-muted"><%= truncate(c.description, length: 60) %></td>
          <td>
            <% if c.hedera_sequence_number.present? %>
              <span class="badge bg-info" title="Hedera seq #<%= c.hedera_sequence_number %>">#<%= c.hedera_sequence_number %></span>
            <% end %>
          </td>
          <td>
            <%= link_to "Edit", edit_song_contribution_path(@song, c), class: "btn btn-outline-light btn-sm" %>
            <%= button_to "Ã—", song_contribution_path(@song, c), method: :delete, class: "btn btn-outline-danger btn-sm" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-muted">No contributions yet.</p>
<% end %>
