<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>ðŸ“œ Provenance: <%= @song.title %></h1>
  <div class="d-flex gap-2">
    <%= button_to "Generate Record", song_provenance_generate_path(@song), class: "btn btn-primary btn-sm" %>
    <%= link_to "Back to Song", song_path(@song), class: "btn btn-outline-secondary btn-sm" %>
  </div>
</div>

<% if @song.hedera_topic_id.present? %>
  <div class="alert alert-info">
    <strong>ðŸ”— Hedera Topic:</strong> <%= @song.hedera_topic_id %>
  </div>
<% end %>

<!-- Contribution Chain -->
<h3 class="mt-4 mb-3">Contribution Chain</h3>
<% if @contributions.any? %>
  <div class="list-group">
    <% @contributions.each_with_index do |c, i| %>
      <div class="list-group-item bg-dark border-secondary">
        <div class="d-flex justify-content-between">
          <div>
            <strong><%= i + 1 %>.</strong>
            <span class="badge bg-<%= c.actor_type == 'human' ? 'success' : c.actor_type == 'ai' ? 'warning' : 'info' %>"><%= c.actor_type %></span>
            <strong><%= c.actor_name %></strong> â€” <%= c.role.titleize %>
          </div>
          <% if c.hedera_sequence_number %>
            <small class="text-muted">Hedera #<%= c.hedera_sequence_number %></small>
          <% end %>
        </div>
        <% if c.description.present? %>
          <p class="mb-1 mt-1 text-muted"><%= c.description %></p>
        <% end %>
        <% if c.evidence.present? %>
          <small class="text-muted">Evidence: <%= c.evidence %></small>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <p class="text-muted">No contributions recorded yet.</p>
<% end %>

<!-- Generated Records -->
<h3 class="mt-4 mb-3">Generated Records</h3>
<% if @provenance_records.any? %>
  <table class="table table-dark table-striped">
    <thead>
      <tr><th>Format</th><th>Generated</th><th>Notes</th><th></th></tr>
    </thead>
    <tbody>
      <% @provenance_records.each do |record| %>
        <tr>
          <td><span class="badge bg-secondary"><%= record.format.upcase %></span></td>
          <td><%= record.generated_at&.strftime("%Y-%m-%d %H:%M") %></td>
          <td class="text-muted"><%= record.notes %></td>
          <td><%= link_to "Download", song_provenance_download_path(@song, record), class: "btn btn-outline-light btn-sm" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-muted">No provenance records generated yet.</p>
<% end %>
